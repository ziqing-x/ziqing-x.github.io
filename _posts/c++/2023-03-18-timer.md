---
title: 实现一个记录程序耗时的类
tags: [time cost]
category: c++
---

## 前言

C++11 中提供了一个计时的标准库 <chrono>,里面有三种时钟 clock: steady_clock， system_clock 和high_resolution_clock;

+ steady_clock 类似秒表；适合用于记录程序耗时；

+ system_clock 是系统的时钟, 因为系统的时钟可以修改, 甚至可以网络对时, 所以用系统时间计算时间差可能不准。

+ high_resolution_clock 是当前系统能够提供的最高精度的时钟, 它也是不可以修改的, 相当于 steady_clock 的高精度版本。

这里我们就用<font color = red>high_resolution_clock</font>来记录程序耗时(采用RAII方式)；直接上代码。

```c++
#include <chrono>
#include <iostream>

class Timer {
public:
  enum Unit : uint8_t { S = 0, MS = 1, US = 2, NS = 3 };
  Timer(const Timer &t) = delete;
  Timer &operator=(const Timer &t) = delete;
  Timer(Unit u = Unit::MS) : u_(u), start_{clock_::now()} {}
  ~Timer() {
    const auto &&cost = std::chrono::duration_cast<std::chrono::nanoseconds>(
                            clock_::now() - start_)
                            .count();
    switch (u_) {
    case Unit::S:
      std::cout << "cost: " << cost / 1000000000 << " s\n";
      break;

    case Unit::MS:
      std::cout << "cost: " << cost / 1000000 << " ms\n";
      break;

    case Unit::US:
      std::cout << "cost: " << cost / 1000 << " us\n";
      break;

    case Unit::NS:
      std::cout << "cost: " << cost << " ns\n";
      break;

    default:
      std::cout << "cost: " << cost / 1000000 << " ms\n";
      break;
    }
  }

private:
  using clock_ = std::chrono::high_resolution_clock;
  std::chrono::time_point<clock_> start_;
  Unit u_;
};



#include <unistd.h>

void test(Timer::Unit u) {
  Timer t(u);
  sleep(2);
}

int main() {
  test(Timer::Unit::S);
  test(Timer::Unit::MS);
  test(Timer::Unit::US);
  test(Timer::Unit::NS);
  Timer t;
  sleep(2);

  return 0;
}
```